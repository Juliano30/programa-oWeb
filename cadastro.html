<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de Voluntário</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <style>
        .help-text {
            color: #666;
            font-size: 0.875rem;
            margin-left: 0.5rem;
            display: block;
            margin-top: 0.25rem;
        }
        
        fieldset {
            margin-bottom: 1.5rem;
            padding: 1.5rem;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        input:invalid, select:invalid {
            border-color: #dc3545;
        }
        
        input:valid, select:valid {
            border-color: #28a745;
        }
        
        input:focus, select:focus {
            outline: none;
            box-shadow: 0 0 0 0.2rem rgba(0,123,255,.25);
            border-color: #80bdff;
        }
        
        .error-message {
            color: #dc3545;
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }
    </style>
    <script>
        function mascaraCPF(input) {
            input.value = input.value.replace(/\D/g,"")
                .replace(/(\d{3})(\d)/,"$1.$2")
                .replace(/(\d{3})(\d)/,"$1.$2")
                .replace(/(\d{3})(\d{1,2})$/,"$1-$2");
        }

        function mascaraTelefone(input) {
            input.value = input.value.replace(/\D/g,"")
                .replace(/(\d{2})(\d)/,"($1) $2")
                .replace(/(\d{5})(\d{4})$/,"$1-$2");
        }

        function mascaraCEP(input) {
            input.value = input.value.replace(/\D/g,"")
                .replace(/(\d{5})(\d{3})$/,"$1-$2");
            if (input.value.length === 9) {
                buscarCEP(input.value);
            }
        }

        function validarCPF(cpf) {
            cpf = cpf.replace(/[^\d]/g, '');
            if (cpf.length !== 11) return false;
            
            // Verifica CPFs com dígitos iguais
            if (/^(\d)\1{10}$/.test(cpf)) return false;
            
            // Validação dos dígitos verificadores
            let soma = 0;
            for (let i = 0; i < 9; i++) {
                soma += parseInt(cpf[i]) * (10 - i);
            }
            let digito1 = (soma * 10) % 11;
            if (digito1 === 10) digito1 = 0;
            if (digito1 !== parseInt(cpf[9])) return false;
            
            soma = 0;
            for (let i = 0; i < 10; i++) {
                soma += parseInt(cpf[i]) * (11 - i);
            }
            let digito2 = (soma * 10) % 11;
            if (digito2 === 10) digito2 = 0;
            if (digito2 !== parseInt(cpf[10])) return false;
            
            return true;
        }

        async function buscarCEP(cep) {
            cep = cep.replace(/\D/g, '');
            if (cep.length !== 8) return;

            try {
                const response = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
                const data = await response.json();
                
                if (!data.erro) {
                    document.getElementById('endereco').value = data.logradouro;
                    document.getElementById('cidade').value = data.localidade;
                    document.getElementById('estado').value = data.uf;
                    
                    // Foca no número após preenchimento automático
                    document.getElementById('numero').focus();
                } else {
                    alert('CEP não encontrado');
                }
            } catch (error) {
                console.error('Erro ao buscar CEP:', error);
                alert('Erro ao buscar CEP. Tente novamente mais tarde.');
            }
        }

        window.onload = function() {
            const form = document.getElementById('formCadastro');
            document.getElementById("year").textContent = new Date().getFullYear();
            
            // Adiciona máscaras
            document.getElementById("cpf").addEventListener("input", function() { mascaraCPF(this); });
            document.getElementById("telefone").addEventListener("input", function() { mascaraTelefone(this); });
            document.getElementById("cep").addEventListener("input", function() { mascaraCEP(this); });
            
            // Validação do formulário
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const cpf = document.getElementById('cpf').value;
                if (!validarCPF(cpf)) {
                    alert('CPF inválido. Por favor, verifique.');
                    return;
                }

                // Validação da data de nascimento
                const nascimento = new Date(document.getElementById('nascimento').value);
                const hoje = new Date();
                const idade = hoje.getFullYear() - nascimento.getFullYear();
                if (idade < 18) {
                    alert('É necessário ter mais de 18 anos para se cadastrar.');
                    return;
                }

                // Se passou por todas as validações
                alert('Formulário enviado com sucesso!');
                form.reset();
            });
        };
    </script>
</head>
<body>
    <header>
        <h1>Cadastro de Voluntário</h1>
        <nav aria-label="Menu principal">
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="projetos.html">Projetos</a></li>
                <li><a href="cadastro.html">Cadastro</a></li>
            </ul>
        </nav>
    </header>
    <main>
        <section>
            <h2>Formulário de Cadastro</h2>
            <picture>
                <source srcset="assets/img/cadastro.webp" type="image/webp">
                <source srcset="assets/img/cadastro.jpg" type="image/jpeg">
                <img src="assets/img/cadastro.jpg" alt="Cadastro" class="form-image">
            </picture>
            <form id="formCadastro" action="#" method="post">
                <fieldset>
                    <legend>Dados Pessoais</legend>
                    <label for="nome">Nome Completo:</label>
                    <input type="text" id="nome" name="nome" required minlength="3">
                    <br>
                    <label for="email">E-mail:</label>
                    <input type="email" id="email" name="email" required>
                    <br>
                    <label for="cpf">CPF:</label>
                    <input type="text" id="cpf" name="cpf" required 
                           pattern="\d{3}\.\d{3}\.\d{3}-\d{2}"
                           placeholder="000.000.000-00"
                           title="Digite um CPF válido no formato: 000.000.000-00"
                           aria-describedby="cpf-help">
                    <small id="cpf-help" class="help-text">Digite apenas números (11 dígitos)</small>
                    <br>
                    <label for="telefone">Telefone:</label>
                    <input type="tel" id="telefone" name="telefone" required 
                           pattern="\(\d{2}\) \d{5}-\d{4}"
                           placeholder="(00) 00000-0000"
                           title="Digite um telefone válido no formato: (00) 00000-0000"
                           aria-describedby="tel-help">
                    <small id="tel-help" class="help-text">Digite apenas números com DDD</small>
                    <br>
                    <label for="nascimento">Data de Nascimento:</label>
                    <input type="date" id="nascimento" name="nascimento" required
                           aria-describedby="idade-help"
                           max="2007-12-31">
                    <small id="idade-help" class="help-text">Você deve ter pelo menos 18 anos</small>
                </fieldset>
                <fieldset>
                    <legend>Endereço</legend>
                    <label for="cep">CEP:</label>
                    <input type="text" id="cep" name="cep" required pattern="\d{5}-\d{3}" placeholder="00000-000" title="Digite um CEP válido">
                    <br>
                    <label for="endereco">Logradouro:</label>
                    <input type="text" id="endereco" name="endereco" required>
                    <br>
                    <label for="numero">Número:</label>
                    <input type="text" id="numero" name="numero" required>
                    <br>
                    <label for="complemento">Complemento:</label>
                    <input type="text" id="complemento" name="complemento" placeholder="Apartamento, sala, etc.">
                    <br>
                    <label for="bairro">Bairro:</label>
                    <input type="text" id="bairro" name="bairro" required>
                    <br>
                    <label for="cidade">Cidade:</label>
                    <input type="text" id="cidade" name="cidade" required>
                    <br>
                    <label for="estado">Estado:</label>
                    <select id="estado" name="estado" required>
                        <option value="">Selecione um estado</option>
                        <option value="AC">Acre</option>
                        <option value="AL">Alagoas</option>
                        <option value="AP">Amapá</option>
                        <option value="AM">Amazonas</option>
                        <option value="BA">Bahia</option>
                        <option value="CE">Ceará</option>
                        <option value="DF">Distrito Federal</option>
                        <option value="ES">Espírito Santo</option>
                        <option value="GO">Goiás</option>
                        <option value="MA">Maranhão</option>
                        <option value="MT">Mato Grosso</option>
                        <option value="MS">Mato Grosso do Sul</option>
                        <option value="MG">Minas Gerais</option>
                        <option value="PA">Pará</option>
                        <option value="PB">Paraíba</option>
                        <option value="PR">Paraná</option>
                        <option value="PE">Pernambuco</option>
                        <option value="PI">Piauí</option>
                        <option value="RJ">Rio de Janeiro</option>
                        <option value="RN">Rio Grande do Norte</option>
                        <option value="RS">Rio Grande do Sul</option>
                        <option value="RO">Rondônia</option>
                        <option value="RR">Roraima</option>
                        <option value="SC">Santa Catarina</option>
                        <option value="SP">São Paulo</option>
                        <option value="SE">Sergipe</option>
                        <option value="TO">Tocantins</option>
                    </select>
                </fieldset>
                <br>
                <button type="submit">Enviar</button>
            </form>
        </section>
    </main>
    <footer>
        <p>&copy; <span id="year"></span> Minha ONG. Todos os direitos reservados.</p>
    </footer>
</body>
</html>
